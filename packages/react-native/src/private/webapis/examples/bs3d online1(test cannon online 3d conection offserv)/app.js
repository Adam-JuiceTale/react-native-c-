var express = require('express');
var app = express();
var serv = require('http').Server(app);
var socketlist={}
var CANNON = require('cannon');
app.get('/',function(req, res) {
	res.sendFile(__dirname + '/client/index.html');
});
app.use('/client',express.static(__dirname + '/client'));

serv.listen(process.env.PORT || 2011);

var io = require('socket.io')(serv,{})
io.sockets.on('connection', function(socket){
	
	socketlist[socket.id] = socket;
	 socket.emit('whoaem',{id:socket.id});
	 
	//socketlist[socket.id].chassisShape;
            socketlist[socket.id].chassisShape = new CANNON.Box(new CANNON.Vec3(2, 1,0.5));
            socketlist[socket.id].chassisBody = new CANNON.Body({ mass: 150 });
			socketlist[socket.id].chassisBody.quaternion.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), -Math.PI / 2)
            socketlist[socket.id].chassisBody.addShape(socketlist[socket.id].chassisShape);
			var s =1.5
			var shape = new CANNON.Box(new CANNON.Vec3(0.5*s,0.5*s,0.5*s));
          //socketlist[socket.id].chassisBody.addShape(shape, new CANNON.Vec3( s, 0,-17));
            socketlist[socket.id].chassisBody.position.set(50, 202, -601);
			//socketlist[socket.id].testpos={}
			//socketlist[socket.id].testpos.x=socketlist[socket.id].chassisBody.position.x
			//socketlist[socket.id].testpos.y=socketlist[socket.id].chassisBody.position.y
			//socketlist[socket.id].testpos.z=socketlist[socket.id].chassisBody.position.z
            socketlist[socket.id].chassisBody.angularVelocity.set(0, 0, 0.5);
            //demo.addVisual(chassisBody);

            var options = {
                radius: 0.5,
                directionLocal: new CANNON.Vec3(0, 0, -1),
                suspensionStiffness: 30,
                suspensionRestLength: 0.3,
                frictionSlip: 5,
                dampingRelaxation: 2.3,
                dampingCompression: 4.4,
                maxSuspensionForce: 100000,
                rollInfluence:  0.01,
                axleLocal: new CANNON.Vec3(0, 1, 0),
                chassisConnectionPointLocal: new CANNON.Vec3(1, 1, 0),
                maxSuspensionTravel: 0.3,
                customSlidingRotationalSpeed: -30,
                useCustomSlidingRotationalSpeed: true
            };

            // Create the vehicle
            socketlist[socket.id].vehicle = new CANNON.RaycastVehicle({
                chassisBody: socketlist[socket.id].chassisBody,
            });

            options.chassisConnectionPointLocal.set(1, 1, 0);
            socketlist[socket.id].vehicle.addWheel(options);

            options.chassisConnectionPointLocal.set(1, -1, 0);
            socketlist[socket.id].vehicle.addWheel(options);

            options.chassisConnectionPointLocal.set(-1, 1, 0);
            socketlist[socket.id].vehicle.addWheel(options);

            options.chassisConnectionPointLocal.set(-1, -1, 0);
            socketlist[socket.id].vehicle.addWheel(options);

            socketlist[socket.id].vehicle.addToWorld(world);

            var wheelBodies = [];
            for(var i=0; i<socketlist[socket.id].vehicle.wheelInfos.length; i++){
                var wheel = socketlist[socket.id].vehicle.wheelInfos[i];
                var cylinderShape = new CANNON.Cylinder(wheel.radius, wheel.radius, wheel.radius / 2, 20);
                var wheelBody = new CANNON.Body({
                    mass: 0
                });
                wheelBody.type = CANNON.Body.KINEMATIC;
                wheelBody.collisionFilterGroup = 0; // turn off collisions
                var q = new CANNON.Quaternion();
                q.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), Math.PI / 2);
                wheelBody.addShape(cylinderShape, new CANNON.Vec3(), q);
                wheelBodies.push(wheelBody);
                //demo.addVisual(wheelBody);
                world.addBody(wheelBody);
            }

            // Update wheels
            world.addEventListener('postStep', function(){
                for (var i = 0; i < socketlist[socket.id].vehicle.wheelInfos.length; i++) {
                    socketlist[socket.id].vehicle.updateWheelTransform(i);
                    var t = socketlist[socket.id].vehicle.wheelInfos[i].worldTransform;
                    var wheelBody = wheelBodies[i];
                    wheelBody.position.copy(t.position);
                    wheelBody.quaternion.copy(t.quaternion);
                }
            });
			var socid=[]
	 for(var i in socketlist){
		 socid.push(socketlist[i].id)
		 
	 }
	 for(var i in socketlist){
	 socketlist[i].emit('init',socid)
	 }
})

var maxForce = 1000;
  var maxSteerVal = 0.5;
  var goleft=false
  var goright=false
  var goup=false
  var godown=false
 

var world = new CANNON.World() 
            world.broadphase = new CANNON.SAPBroadphase(world);
world.gravity.set(0, -9.8, 0) 
            world.defaultContactMaterial.friction = 0;



            var sizeX = 20,
                sizeY = 64;
var grid=
[
//[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],

]
var matrix = [];
            for (var i = 0; i < sizeX; i++) {
                matrix.push([]);
                for (var j = 0; j < sizeY; j++) {
                    
                       var height = j/7
                    matrix[i].push(height);
                }
            }

            var hfShape = new CANNON.Heightfield(grid, {
                elementSize: 5
            });
            var hfBody = new CANNON.Body({ mass: 0 });
            hfBody.addShape(hfShape);
            hfBody.position.set(-65,-21.4, 130);
			hfBody.quaternion.setFromAxisAngle(new CANNON.Vec3(-1,0,0), Math.PI/2); 
            world.addBody(hfBody);

			
setInterval(function(){

/*
if(goleft===true){

vehicle.setSteeringValue( maxSteerVal, 0);
vehicle.setSteeringValue( maxSteerVal, 1);
}else if(goright===true){
vehicle.setSteeringValue( -maxSteerVal, 0);
vehicle.setSteeringValue( -maxSteerVal, 1);
}else{
vehicle.setSteeringValue( 0, 0);
vehicle.setSteeringValue( 0, 1);
}
if(goup===true){
vehicle.applyEngineForce( -maxForce, 2);
vehicle.applyEngineForce( -maxForce, 3);
}else if(godown===true){
vehicle.applyEngineForce( maxForce, 2);
vehicle.applyEngineForce( maxForce, 3);
}else{
vehicle.applyEngineForce( 0, 2);
vehicle.applyEngineForce( 0, 3);
}
*/
var pack=[]
for(var i in socketlist){
			
var asd={
id:socketlist[i].id,
pos:socketlist[i].chassisBody.position,
quat:socketlist[i].chassisBody.quaternion,
velo:socketlist[i].chassisBody.velocity,
avelo:socketlist[i].chassisBody.angularVelocity,
}
pack.push(asd);	
		}
for(var i in socketlist){
		var socket = socketlist[i];
		socket.emit('newPositions',pack)
		//socket.emit('food',pack2);
	}
world.step(1 / 60)		

  //console.log(chassisBody.position.x,chassisBody.position.y,chassisBody.position.z,Math.sqrt(chassisBody.velocity.x*chassisBody.velocity.x+chassisBody.velocity.z*chassisBody.velocity.z) )

},1000/25)