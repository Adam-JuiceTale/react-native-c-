<canvas id="ctx" width="500px" height="500px" style="position:absolute;top:0px;left:0px"></canvas>
<script src="client/three.min.js"></script>
<script src="client/OrbitControls.js"></script>
<script src="client/GLTFLoader.js"></script>
<script src="client/OBJLoader.js"></script>
<script src="client/MTLLoader.js"></script>
<script src="client/cannon.min.js"></script>
<script src="client/CannonDebugRenderer.js"></script>
<script src="client/socket.io-3.0.5.js"></script>
<script>
var socket = io();
var servpos={}
var ping1=0
var me=null
socket.on('newPositions',function(data){
for(i=0;i<data.length;i++){
for(var i2 in socketlist){
if(data[i].id===socketlist[i2].id){
socketlist[i2].servpos.x=data[i].pos.x
socketlist[i2].servpos.y=data[i].pos.y
socketlist[i2].servpos.z=data[i].pos.z
socketlist[i2].servpos.x1=data[i].quat.x
socketlist[i2].servpos.y1=data[i].quat.y
socketlist[i2].servpos.z1=data[i].quat.z
socketlist[i2].servpos.w1=data[i].quat.w
socketlist[i2].servpos.vx=data[i].velo.x
socketlist[i2].servpos.vy=data[i].velo.y
socketlist[i2].servpos.vz=data[i].velo.z
socketlist[i2].servpos.avx=data[i].avelo.x
socketlist[i2].servpos.avy=data[i].avelo.y
socketlist[i2].servpos.avz=data[i].avelo.z
socketlist[i2].ping1=1
console.log(111)
}
}
}
ping1=1
})
socket.on('whoaem',function(data){
//console.log(data.id)
me = data.id
})
var socketlist={}
socket.on('init',function(data){
for(var i=0;i<data.length;i++){
var sovpad=0
for(var i2 in socketlist){
if(data[i]===socketlist[i2].id)
sovpad++
}
if(sovpad===0){

socketlist[data[i]]={}
socketlist[data[i]].id=data[i]
//socketlist[data[i].id].chassisShape;
            socketlist[data[i]].chassisShape = new CANNON.Box(new CANNON.Vec3(2, 1,0.5));
            socketlist[data[i]].chassisBody = new CANNON.Body({ mass: 150 });
			socketlist[data[i]].chassisBody.quaternion.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), -Math.PI / 2)
            socketlist[data[i]].chassisBody.addShape(socketlist[data[i]].chassisShape);
			var s =1.5
			var shape = new CANNON.Box(new CANNON.Vec3(0.5*s,0.5*s,0.5*s));
          //socketlist[data[i]].chassisBody.addShape(shape, new CANNON.Vec3( s, 0,-17));
            socketlist[data[i]].chassisBody.position.set(50, 202, -601);
            socketlist[data[i]].chassisBody.angularVelocity.set(0, 0, 0.5);
            //demo.addVisual(socketlist[data[i]].chassisBody);

            var options = {
                radius: 0.5,
                directionLocal: new CANNON.Vec3(0, 0, -1),
                suspensionStiffness: 30,
                suspensionRestLength: 0.3,
                frictionSlip: 5,
                dampingRelaxation: 2.3,
                dampingCompression: 4.4,
                maxSuspensionForce: 100000,
                rollInfluence:  0.01,
                axleLocal: new CANNON.Vec3(0, 1, 0),
                chassisConnectionPointLocal: new CANNON.Vec3(1, 1, 0),
                maxSuspensionTravel: 0.3,
                customSlidingRotationalSpeed: -30,
                useCustomSlidingRotationalSpeed: true
            };

            // Create the vehicle
            socketlist[data[i]].vehicle = new CANNON.RaycastVehicle({
                chassisBody: socketlist[data[i]].chassisBody,
            });

            options.chassisConnectionPointLocal.set(1, 1, 0);
            socketlist[data[i]].vehicle.addWheel(options);

            options.chassisConnectionPointLocal.set(1, -1, 0);
            socketlist[data[i]].vehicle.addWheel(options);

            options.chassisConnectionPointLocal.set(-1, 1, 0);
            socketlist[data[i]].vehicle.addWheel(options);

            options.chassisConnectionPointLocal.set(-1, -1, 0);
            socketlist[data[i]].vehicle.addWheel(options);

            socketlist[data[i]].vehicle.addToWorld(world);
//console.log(socketlist[data[i]].vehicle.wheelInfos.length)
            var wheelBodies = [];
            for(var i2=0; i2<socketlist[data[i]].vehicle.wheelInfos.length; i2++){
                var wheel = socketlist[data[i]].vehicle.wheelInfos[i2];
                var cylinderShape = new CANNON.Cylinder(wheel.radius, wheel.radius, wheel.radius / 2, 20);
                var wheelBody = new CANNON.Body({
                    mass: 0
                });
                wheelBody.type = CANNON.Body.KINEMATIC;
                wheelBody.collisionFilterGroup = 0; // turn off collisions
                var q = new CANNON.Quaternion();
                q.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), Math.PI / 2);
                wheelBody.addShape(cylinderShape, new CANNON.Vec3(), q);
                wheelBodies.push(wheelBody);
                //demo.addVisual(wheelBody);
                world.addBody(wheelBody);
            }
var asd2=socketlist[data[i]].vehicle.wheelInfos.length
var asd3=socketlist[data[i]]
            // Update wheels
            world.addEventListener('postStep', function(){
                for (var i = 0; i < asd2; i++) {
                    asd3.vehicle.updateWheelTransform(i);
                    var t = asd3.vehicle.wheelInfos[i].worldTransform;
                    var wheelBody = wheelBodies[i];
                    wheelBody.position.copy(t.position);
                    wheelBody.quaternion.copy(t.quaternion);
                }
            });
}
}
})
var ctx = document.getElementById('ctx')//.getContext('2d')
var WIDTH2 = window.innerWidth 
var HEIGHT2 = window.innerHeight 
  ctx.width  = WIDTH2
  ctx.height = HEIGHT2
var maxForce = 1000;
  var maxSteerVal = 0.5;
  var goleft=false
  var goright=false
  var goup=false
  var godown=false
  document.onkeydown=function(event){

            switch(event.keyCode){

            case 87: // forward
                //vehicle.applyEngineForce( -maxForce, 2);
                //vehicle.applyEngineForce( -maxForce, 3);
				goup=true
                break;

            case 83: // backward
                //vehicle.applyEngineForce( maxForce, 2);
                //vehicle.applyEngineForce( maxForce, 3);
				godown=true
                break;

            case 66: // b
                //vehicle.setBrake(brakeForce, 0);
                //vehicle.setBrake(brakeForce, 1);
               // vehicle.setBrake(brakeForce, 2);
                //vehicle.setBrake(brakeForce, 3);
                break;

            case 68: // right
                //vehicle.setSteeringValue( -maxSteerVal, 0);
                //vehicle.setSteeringValue( -maxSteerVal, 1);
				goright=true
                break;

            case 65: // left
                //vehicle.setSteeringValue( maxSteerVal, 0);
                //vehicle.setSteeringValue( maxSteerVal, 1);
				goleft=true
                break;

            }
			}
  document.onkeyup=function(event){
            switch(event.keyCode){

            case 87: // forward
                //vehicle.applyEngineForce( -maxForce, 2);
                //vehicle.applyEngineForce( -maxForce, 3);
				goup=false
                break;

            case 83: // backward
                //vehicle.applyEngineForce( maxForce, 2);
                //vehicle.applyEngineForce( maxForce, 3);
				godown=false
                break;

            case 66: // b
                //vehicle.setBrake(brakeForce, 0);
                //vehicle.setBrake(brakeForce, 1);
               // vehicle.setBrake(brakeForce, 2);
                //vehicle.setBrake(brakeForce, 3);
                break;

            case 68: // right
                //vehicle.setSteeringValue( -maxSteerVal, 0);
                //vehicle.setSteeringValue( -maxSteerVal, 1);
				goright=false
                break;

            case 65: // left
                //vehicle.setSteeringValue( maxSteerVal, 0);
                //vehicle.setSteeringValue( maxSteerVal, 1);
				goleft=false
                break;

            }
			}
var rende = new THREE.WebGLRenderer({canvas:ctx})
rende.setClearColor(0x000000)
var scene = new THREE.Scene()
var camera = new THREE.PerspectiveCamera(45, WIDTH2/HEIGHT2,0.1,5000)
camera.position.set(87,221,-596)

//var laser = new THREE.AmbientLight(0xffffff)
//scene.add(laser)
    const color = 0xffe3b0;
    const intensity = 1.5;
    const light = new THREE.DirectionalLight(color, intensity);
    light.position.set(5, 10, 2);
    scene.add(light);
    scene.add(light.target);
var geametryS = new THREE.SphereGeometry(1,1,1)
var materialS = new THREE.MeshBasicMaterial({color:0x00ff00, wireframe:true})
var meshS= new THREE.Mesh(geametryS,materialS)
//meshS.position.y+=2.2
//meshS.position.z-=3
meshS.rotation.y=3.1+3.1/2
meshS.rotation.x=1.6
scene.add(meshS)
meshS.visible=false
var glftload = new THREE.GLTFLoader()

glftload.load('https://proginvert.github.io/3d_resources/aud/tera/tera4.gltf',(gltfScene)=>{
var model = gltfScene.scene



//model.scale.set(3, 3, 3);
model.position.y-=22//*3

scene.add(model);
})


var locker2 = new THREE.Clock()
var biker=null
glftload.load('https://proginvert.github.io/3d_resources/aud/bike/scene.gltf',(gltfScene)=>{
biker = gltfScene.scene
biker.mixer = new THREE.AnimationMixer(biker)
biker.mixer.clipAction(gltfScene.animations[0]).play()
biker.add(meshS)

//biker.scale.set(3, 3, 3);
//biker.position.y-=22//*3
biker.visible=false
scene.add(biker);
})
var controls = new THREE.OrbitControls(camera, ctx);
controls.update();
var world = new CANNON.World() 
            world.broadphase = new CANNON.SAPBroadphase(world);
world.gravity.set(0, -9.8, 0) 
            world.defaultContactMaterial.friction = 0;
var CannonDebugRenderer = new THREE.CannonDebugRenderer(scene, world)


            var sizeX = 20,
                sizeY = 64;
var grid=
[
//[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],
[0,0,1,1,1,1,2,2,2,2,3,3,4,5,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,10,10,11,11,11,11,12,12,12,12,12,12,12,13,14,15,16,16,16,16,16,16,16,16,16,16,16,16,16,17,20,22,23,25,25,25,26,27,27,27,28,28,28,28,28,28,28,28,28,28,32,34,36,37,55,60,65,68,72,74,75,76,76,76,77,77,77,77,77,77,77,77,77,79,88,92,99,100,120,130,134,135,140,145,150,155,160,165,170,175,175,185,190,195,200,203,208,210,212,214,215,216,217,218,219,220,221,221,221,221,222,222,222,222,222,222,222,222,222,222],

]
var matrix = [];
            for (var i = 0; i < sizeX; i++) {
                matrix.push([]);
                for (var j = 0; j < sizeY; j++) {
                    
                        height = j/7
                    matrix[i].push(height);
                }
            }

            var hfShape = new CANNON.Heightfield(grid, {
                elementSize: 5
            });
            var hfBody = new CANNON.Body({ mass: 0 });
            hfBody.addShape(hfShape);
            hfBody.position.set(-65,-21.4, 130);
			hfBody.quaternion.setFromAxisAngle(new CANNON.Vec3(-1,0,0), Math.PI/2); 
            world.addBody(hfBody);
			var gog=0
			//controls.target.set(chassisBody.position.x,chassisBody.position.y,chassisBody.position.z)
			
setInterval(function(){
if(biker!==null){
for(var i in socketlist){
//console.log(socketlist[i].id)
if(socketlist[i].id===me){
var oldX=socketlist[i].chassisBody.position.x
var oldY=socketlist[i].chassisBody.position.y
var oldZ=socketlist[i].chassisBody.position.z

if(goleft===true){
  console.log(123)
socketlist[i].vehicle.setSteeringValue( maxSteerVal, 0);
socketlist[i].vehicle.setSteeringValue( maxSteerVal, 1);
}else if(goright===true){
socketlist[i].vehicle.setSteeringValue( -maxSteerVal, 0);
socketlist[i].vehicle.setSteeringValue( -maxSteerVal, 1);
}else{
socketlist[i].vehicle.setSteeringValue( 0, 0);
socketlist[i].vehicle.setSteeringValue( 0, 1);
}
if(goup===true){
socketlist[i].vehicle.applyEngineForce( -maxForce, 2);
socketlist[i].vehicle.applyEngineForce( -maxForce, 3);
}else if(godown===true){
socketlist[i].vehicle.applyEngineForce( maxForce, 2);
socketlist[i].vehicle.applyEngineForce( maxForce, 3);
}else{
socketlist[i].vehicle.applyEngineForce( 0, 2);
socketlist[i].vehicle.applyEngineForce( 0, 3);
}

biker.mixer.update(locker2.getDelta())
biker.position.z = socketlist[i].chassisBody.position.z 
        biker.position.y = socketlist[i].chassisBody.position.y
        biker.position.x = socketlist[i].chassisBody.position.x

        biker.quaternion.z = socketlist[i].chassisBody.quaternion.z //Повороты
        biker.quaternion.y = socketlist[i].chassisBody.quaternion.y
        biker.quaternion.x = socketlist[i].chassisBody.quaternion.x
        biker.quaternion.w = socketlist[i].chassisBody.quaternion.w
		//if(gog<100){
		}
}
world.step(1 / 60)	
//if(ping1===1){
for(var i in socketlist){
if(socketlist[i].ping1&&socketlist[i].ping1===1){
socketlist[i].chassisBody.position.set(socketlist[i].servpos.x, socketlist[i].servpos.y, socketlist[i].servpos.z);	
socketlist[i].chassisBody.quaternion.x = socketlist[i].servpos.x1
socketlist[i].chassisBody.quaternion.y = socketlist[i].servpos.y1
socketlist[i].chassisBody.quaternion.z = socketlist[i].servpos.z1
socketlist[i].chassisBody.quaternion.w = socketlist[i].servpos.w1
socketlist[i].chassisBody.velocity.set(socketlist[i].servpos.vx,socketlist[i].servpos.vy,socketlist[i].servpos.vz)
socketlist[i].chassisBody.angularVelocity.set(socketlist[i].servpos.avx, socketlist[i].servpos.avy, socketlist[i].servpos.avz);
socketlist[i].ping1=0
}
}
//ping1=0
//}
var cameradotpos = new THREE.Vector3;
    meshS.getWorldPosition(cameradotpos);
	var cameradotpos2 = new THREE.Quaternion();
	meshS.getWorldQuaternion(cameradotpos2);
	/*
    camera.position.set(cameradotpos.x, cameradotpos.y, cameradotpos.z);
        camera.quaternion.z = cameradotpos2.z //Повороты
        camera.quaternion.y = cameradotpos2.y
        camera.quaternion.x = cameradotpos2.x
        camera.quaternion.w = cameradotpos2.w
		*/
for(var i in socketlist){
if(socketlist[i].id===me){
var diffX=socketlist[i].chassisBody.position.x-oldX
var diffY=socketlist[i].chassisBody.position.y-oldY
var diffZ=socketlist[i].chassisBody.position.z-oldZ
camera.position.x+=diffX
camera.position.y+=diffY
camera.position.z+=diffZ
controls.target.set(socketlist[i].chassisBody.position.x, socketlist[i].chassisBody.position.y, socketlist[i].chassisBody.position.z);
}
}
//gog++
//}
		//camera.position.set(meshS.position.x,meshS.position.y,meshS.position.z)
		//camera.rotation.set(meshS.rotation.x,meshS.rotation.y,meshS.rotation.z)


CannonDebugRenderer.update() // Update - CannonDebugRenderer
rende.render(scene,camera)

}
},1000/25)
</script>